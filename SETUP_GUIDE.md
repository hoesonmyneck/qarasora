# Руководство по установке и запуску Qarasora

## Требования

- Node.js 18+ 
- PostgreSQL 14+
- npm или yarn

## Установка PostgreSQL

### Windows
1. Скачайте PostgreSQL с официального сайта: https://www.postgresql.org/download/windows/
2. Установите PostgreSQL (запомните пароль для пользователя postgres)
3. После установки PostgreSQL будет доступен на порту 5432

### Создание базы данных

Откройте pgAdmin или psql и выполните:

```sql
CREATE DATABASE qarasora;
```

Или через командную строку:

```bash
# Войдите в psql
psql -U postgres

# Создайте базу данных
CREATE DATABASE qarasora;

# Выйдите
\q
```

## Установка и запуск бекенда

1. Перейдите в папку бекенда:
```bash
cd backend
```

2. Установите зависимости:
```bash
npm install
```

3. Настройте переменные окружения:
   - Отредактируйте файл `.env` в папке `backend`
   - Укажите правильный пароль для PostgreSQL в параметре `DB_PASSWORD`

4. Инициализируйте базу данных:
```bash
npm run init-db
```

Эта команда создаст все необходимые таблицы и добавит тестовые данные.

**Учетные данные по умолчанию:**
- Админ: `username=admin`, `password=admin`
- Пользователь: `username=user`, `password=user`

5. Запустите сервер:
```bash
# Режим разработки (с автоперезагрузкой)
npm run dev

# Или обычный режим
npm start
```

Сервер запустится на `http://localhost:3001`

## Установка и запуск фронтенда

1. Вернитесь в корневую папку проекта:
```bash
cd ..
```

2. Создайте файл `.env` в корне проекта (если его нет):
```bash
# Скопируйте из примера
copy .env.example .env
```

3. Установите зависимости (если еще не установлены):
```bash
npm install
```

4. Запустите фронтенд:
```bash
npm run dev
```

Фронтенд запустится на `http://localhost:5173`

## Проверка работы

1. Откройте браузер и перейдите на `http://localhost:5173`
2. Перейдите на страницу "Портал" (`/portal`)
3. Войдите используя учетные данные:
   - Логин: `admin`
   - Пароль: `admin`

## API Endpoints

После запуска бекенда API будет доступно по адресу `http://localhost:3001/api`

Основные endpoints:

- `POST /api/auth/login` - Авторизация
- `GET /api/news` - Получить все новости
- `GET /api/farms` - Получить все фермы (требуется авторизация)
- `GET /api/documents` - Получить все документы (требуется авторизация)
- `POST /api/users` - Создать пользователя (только админ)

Полный список endpoints смотрите в `backend/README.md`

## Структура проекта

```
qarasora/
├── backend/              # Backend API (Node.js + Express)
│   ├── config/          # Конфигурация (БД)
│   ├── middleware/      # Middleware (авторизация, загрузка файлов)
│   ├── routes/          # API маршруты
│   ├── scripts/         # Скрипты (инициализация БД)
│   ├── uploads/         # Загруженные файлы
│   ├── .env             # Переменные окружения
│   ├── server.js        # Главный файл сервера
│   └── package.json
├── src/                 # Frontend (Vue 3)
│   ├── pages/          # Страницы приложения
│   ├── services/       # API сервисы
│   ├── assets/         # Статические файлы
│   └── ...
├── .env                # Переменные окружения фронтенда
└── package.json
```

## Возможные проблемы

### Ошибка подключения к базе данных

Если видите ошибку "Could not connect to database":
1. Убедитесь, что PostgreSQL запущен
2. Проверьте настройки в `backend/.env`
3. Проверьте, что база данных `qarasora` создана

### Ошибка CORS

Если фронтенд не может подключиться к бекенду:
1. Убедитесь, что в `backend/.env` указан правильный `FRONTEND_URL`
2. По умолчанию должно быть `http://localhost:5173`

### Ошибка "Port already in use"

Если порт 3001 или 5173 уже занят:
1. Измените порт в соответствующем `.env` файле
2. Перезапустите сервер

## Production deployment

Для развертывания в production:

1. Измените `NODE_ENV=production` в `backend/.env`
2. Установите надежный `JWT_SECRET`
3. Измените пароль администратора после первого входа
4. Настройте реверс-прокси (nginx) для бекенда и фронтенда
5. Используйте менеджер процессов (PM2) для запуска бекенда

```bash
# Установка PM2
npm install -g pm2

# Запуск бекенда через PM2
cd backend
pm2 start server.js --name qarasora-api

# Сборка фронтенда
cd ..
npm run build

# Фронтенд будет в папке dist/
```

## Поддержка

При возникновении проблем проверьте:
- Логи бекенда в консоли
- Логи PostgreSQL
- Консоль браузера (F12) для ошибок фронтенда
